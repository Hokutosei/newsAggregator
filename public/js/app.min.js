!function(t,e,n){"use strict";function i(t,n,i){o.directive(t,["$parse","$swipe",function(o,a){var r=75,c=.3,s=30;return function(u,l,f){function p(t){if(!g)return!1;var e=Math.abs(t.y-g.y),i=(t.x-g.x)*n;return d&&r>e&&i>0&&i>s&&c>e/i}var g,d,h=o(f[t]),m=["touch"];e.isDefined(f.ngSwipeDisableMouse)||m.push("mouse"),a.bind(l,{start:function(t,e){g=t,d=!0},cancel:function(t){d=!1},end:function(t,e){p(t)&&u.$apply(function(){l.triggerHandler(i),h(u,{$event:e})})}},m)}}])}var o=e.module("ngTouch",[]);o.factory("$swipe",[function(){function t(t){var e=t.touches&&t.touches.length?t.touches:[t],n=t.changedTouches&&t.changedTouches[0]||t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]||e[0].originalEvent||e[0];return{x:n.clientX,y:n.clientY}}function n(t,n){var i=[];return e.forEach(t,function(t){var e=o[t][n];e&&i.push(e)}),i.join(" ")}var i=10,o={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}};return{bind:function(e,o,a){var r,c,s,u,l=!1;a=a||["mouse","touch"],e.on(n(a,"start"),function(e){s=t(e),l=!0,r=0,c=0,u=s,o.start&&o.start(s,e)});var f=n(a,"cancel");f&&e.on(f,function(t){l=!1,o.cancel&&o.cancel(t)}),e.on(n(a,"move"),function(e){if(l&&s){var n=t(e);if(r+=Math.abs(n.x-u.x),c+=Math.abs(n.y-u.y),u=n,!(i>r&&i>c))return c>r?(l=!1,void(o.cancel&&o.cancel(e))):(e.preventDefault(),void(o.move&&o.move(n,e)))}}),e.on(n(a,"end"),function(e){l&&(l=!1,o.end&&o.end(t(e),e))})}}}]),o.config(["$provide",function(t){t.decorator("ngClickDirective",["$delegate",function(t){return t.shift(),t}])}]),o.directive("ngClick",["$parse","$timeout","$rootElement",function(t,n,i){function o(t,e,n,i){return Math.abs(t-n)<h&&Math.abs(e-i)<h}function a(t,e,n){for(var i=0;i<t.length;i+=2)if(o(t[i],t[i+1],e,n))return t.splice(i,i+2),!0;return!1}function r(t){if(!(Date.now()-u>d)){var e=t.touches&&t.touches.length?t.touches:[t],n=e[0].clientX,i=e[0].clientY;1>n&&1>i||f&&f[0]===n&&f[1]===i||(f&&(f=null),"label"===t.target.tagName.toLowerCase()&&(f=[n,i]),a(l,n,i)||(t.stopPropagation(),t.preventDefault(),t.target&&t.target.blur()))}}function c(t){var e=t.touches&&t.touches.length?t.touches:[t],i=e[0].clientX,o=e[0].clientY;l.push(i,o),n(function(){for(var t=0;t<l.length;t+=2)if(l[t]==i&&l[t+1]==o)return void l.splice(t,t+2)},d,!1)}function s(t,e){l||(i[0].addEventListener("click",r,!0),i[0].addEventListener("touchstart",c,!0),l=[]),u=Date.now(),a(l,t,e)}var u,l,f,p=750,g=12,d=2500,h=25,m="ng-click-active";return function(n,i,o){function a(){d=!1,i.removeClass(m)}var r,c,u,l,f=t(o.ngClick),d=!1;i.on("touchstart",function(t){d=!0,r=t.target?t.target:t.srcElement,3==r.nodeType&&(r=r.parentNode),i.addClass(m),c=Date.now();var e=t.touches&&t.touches.length?t.touches:[t],n=e[0].originalEvent||e[0];u=n.clientX,l=n.clientY}),i.on("touchmove",function(t){a()}),i.on("touchcancel",function(t){a()}),i.on("touchend",function(t){var n=Date.now()-c,f=t.changedTouches&&t.changedTouches.length?t.changedTouches:t.touches&&t.touches.length?t.touches:[t],h=f[0].originalEvent||f[0],m=h.clientX,w=h.clientY,v=Math.sqrt(Math.pow(m-u,2)+Math.pow(w-l,2));d&&p>n&&g>v&&(s(m,w),r&&r.blur(),e.isDefined(o.disabled)&&o.disabled!==!1||i.triggerHandler("click",[t])),a()}),i.onclick=function(t){},i.on("click",function(t,e){n.$apply(function(){f(n,{$event:e||t})})}),i.on("mousedown",function(t){i.addClass(m)}),i.on("mousemove mouseup",function(t){i.removeClass(m)})}}]),i("ngSwipeLeft",-1,"swipeleft"),i("ngSwipeRight",1,"swiperight")}(window,window.angular),function(t){"use strict";t.module("angulartics.google.analytics",["angulartics"]).config(["$analyticsProvider",function(t){t.settings.trackRelativePath=!0,t.registerPageTrack(function(t){window._gaq&&_gaq.push(["_trackPageview",t]),window.ga&&ga("send","pageview",t)}),t.registerEventTrack(function(t,e){if(e&&e.category){if(e.value){var n=parseInt(e.value,10);e.value=isNaN(n)?0:n}if(window._gaq)_gaq.push(["_trackEvent",e.category,t,e.label,e.value,e.noninteraction]);else if(window.ga){for(var i={eventCategory:e.category||null,eventAction:t||null,eventLabel:e.label||null,eventValue:e.value||null,nonInteraction:e.noninteraction||null},o=1;20>=o;o++)e["dimension"+o.toString()]&&(i["dimension"+o.toString()]=e["dimension"+o.toString()]),e["metric"+o.toString()]&&(i["metric"+o.toString()]=e["metric"+o.toString()]);ga("send","event",i)}}})}])}(angular),function(t,e){"use strict";var n=window.angulartics||(window.angulartics={});n.waitForVendorCount=0,n.waitForVendorApi=function(t,e,i,o,a){a||n.waitForVendorCount++,o||(o=i,i=void 0),!Object.prototype.hasOwnProperty.call(window,t)||void 0!==i&&void 0===window[t][i]?setTimeout(function(){n.waitForVendorApi(t,e,i,o,!0)},e):(n.waitForVendorCount--,o(window[t]))},t.module("angulartics",[]).provider("$analytics",function(){var e={pageTracking:{autoTrackFirstPage:!0,autoTrackVirtualPages:!0,trackRelativePath:!1,autoBasePath:!1,basePath:""},eventTracking:{},bufferFlushDelay:1e3},i=["pageTrack","eventTrack","setAlias","setUsername","setUserProperties","setUserPropertiesOnce","setSuperProperties","setSuperPropertiesOnce"],o={},a={},r=function(t){return function(){n.waitForVendorCount&&(o[t]||(o[t]=[]),o[t].push(arguments))}},c=function(e,n){return a[e]||(a[e]=[]),a[e].push(n),function(){var n=arguments;t.forEach(a[e],function(t){t.apply(this,n)},this)}},s={settings:e},u=function(t,e){e?setTimeout(t,e):t()},l={$get:function(){return s},api:s,settings:e,virtualPageviews:function(t){this.settings.pageTracking.autoTrackVirtualPages=t},firstPageview:function(t){this.settings.pageTracking.autoTrackFirstPage=t},withBase:function(e){this.settings.pageTracking.basePath=e?t.element("base").attr("href").slice(0,-1):""},withAutoBase:function(t){this.settings.pageTracking.autoBasePath=t}},f=function(n,i){s[n]=c(n,i);var a=e[n],r=a?a.bufferFlushDelay:null,l=null!==r?r:e.bufferFlushDelay;t.forEach(o[n],function(t,e){u(function(){i.apply(this,t)},e*l)})},p=function(t){return t.replace(/^./,function(t){return t.toUpperCase()})},g=function(t){var e="register"+p(t);l[e]=function(e){f(t,e)},s[t]=c(t,r(t))};return t.forEach(i,g),l}).run(["$rootScope","$location","$window","$analytics","$injector",function(t,e,n,i,o){if(i.settings.pageTracking.autoTrackFirstPage){var a=!0;if(o.has("$route")){var r=o.get("$route");for(var c in r.routes){a=!1;break}}else if(o.has("$state")){var s=o.get("$state");for(var u in s.get()){a=!1;break}}if(a)if(i.settings.pageTracking.autoBasePath&&(i.settings.pageTracking.basePath=n.location.pathname),i.settings.trackRelativePath){var l=i.settings.pageTracking.basePath+e.url();i.pageTrack(l)}else i.pageTrack(e.absUrl())}i.settings.pageTracking.autoTrackVirtualPages&&(i.settings.pageTracking.autoBasePath&&(i.settings.pageTracking.basePath=n.location.pathname+"#"),o.has("$route")&&t.$on("$routeChangeSuccess",function(t,n){if(!n||!(n.$$route||n).redirectTo){var o=i.settings.pageTracking.basePath+e.url();i.pageTrack(o)}}),o.has("$state")&&t.$on("$stateChangeSuccess",function(t,n){var o=i.settings.pageTracking.basePath+e.url();i.pageTrack(o)}))}]).directive("analyticsOn",["$analytics",function(e){function n(t){return["a:","button:","button:button","button:submit","input:button","input:submit"].indexOf(t.tagName.toLowerCase()+":"+(t.type||""))>=0}function i(t){return n(t),"click"}function o(t){return n(t)?t.innerText||t.value:t.id||t.name||t.tagName}function a(t){return"analytics"===t.substr(0,9)&&-1===["On","Event","If","Properties","EventType"].indexOf(t.substr(9))}function r(t){var e=t.slice(9);return"undefined"!=typeof e&&null!==e&&e.length>0?e.substring(0,1).toLowerCase()+e.substring(1):e}return{restrict:"A",scope:!0,link:function(n,c,s){var u=s.analyticsOn||i(c[0]);n.$analytics={},t.forEach(s.$attr,function(t,e){a(e)&&(n.$analytics[r(e)]=s[e],s.$observe(e,function(t){n.$analytics[r(e)]=t}))}),t.element(c[0]).bind(u,function(i){var a=s.analyticsEvent||o(c[0]);n.$analytics.eventType=i.type,(!s.analyticsIf||n.$eval(s.analyticsIf))&&(s.analyticsProperties&&t.extend(n.$analytics,n.$eval(s.analyticsProperties)),e.eventTrack(a,n.$analytics))})}}}])}(angular),function(){"use strict";app=angular.module("newsAggregator",["ngTouch","ngCookies","angulartics","angulartics.google.analytics","ngResource","ngRoute"]);app.config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{templateUrl:"js/index_page/index.html",controller:"MainCtrl"}).when("/:q",{templateUrl:"js/index_page/index.html",controller:"MainCtrl"}).when("/admin",{templateUrl:"js/pages/admin/templates/admin.html",controller:"AdminController"}).when("/news/:id",{templateUrl:"js/news_page/template/news.html",controller:"NewsPageCtrl"}).when("/registration",{templateUrl:"js/user/templates/login.html",controller:"loginController"}).otherwise({redirectTo:"/"}),e.html5Mode({enabled:!0,requireBase:!0})}]),app.run(["$rootScope","$timeout",function(t,e){t.$on("$routeChangeSuccess",function(t,e){!function(t,e,n){var i=function(){var i,o=t.getElementsByTagName(e)[0];t.getElementById(n)||(i=t.createElement(e),i.id=n,i.src="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.4&appId=604252113051244",o.parentNode.insertBefore(i,o))};i(),setTimeout(function(){i(),FB.XFBML.parse()},4e3)}(document,"script","facebook-jssdk")})}]),app.constant("API","http://localhost:3000")}(),function(){"use strict";app.constant("APP_CONFIG",{APP_NAME:"SocketNews",title_limit:25})}(),function(){"use strict";var t=function(t){console.log(t)};app.controller("HeaderCtrl",["$scope",function(t){t.project_name="learnJap"}]),app.controller("MainCtrl",["$scope","$window","httpService","$analytics","$location","$rootScope","userLocation","$routeParams","userSession","$timeout","adjustStageHeight","APP_CONFIG",function(e,n,i,o,a,r,c,s,u,l,f,p){o.pageTrack("/"),o.eventTrack("index",{category:"index_main",label:"index_label"}),e.news_content_type="latest_news",r.page_title="newsInstance",e.title_limit=p.title_limit,r.content_type=e.news_content_type,e.main_index_news=[],e.main_index_topranks=[];var g=function(){i.fetchTopRankingNews(function(t,n){e.main_index_topranks=t})};e.init=function(){t(u.userSessionId()),u.setUserSession(),$(".materialboxed").materialbox(),$(".dropdown-button").dropdown(),e.news_category_style={},1==_.has(s,"q")&&"registration"!=s.q?i.fetchCategoryNews(s.q).success(function(t){e.main_index_news=t}):i.getNewsContent(r.content_type,function(t,n){e.main_index_news=t.reverse()}),g()},e.news_content=function(t){r.content_type=t,o.eventTrack("index",{category:"index_main",label:t}),"/"!=a.path()?window.location.href="/":i.getNewsContent(r.content_type,function(t,n){e.news_content_type=r.content_type,e.main_index_news=t})},e.feed_more=function(t){o.eventTrack("feed_more",{category:"system_func",label:"feed_more_data"}),i.feedMoreNews(e.news_content_type,t,function(t,n){for(var i=0;i<t.length;i++)e.main_index_news.push(t[i])})},r.$on("update_main_index_news",function(t,n){e.main_index_news=n}),r.$on("empty_main_index_news",function(){e.main_index_news=[]}),e.ga_event=function(t){i.incrementNewsItemScore(t),o.eventTrack("news_item_"+t.title,{category:"news_clicks",label:"news_item_clicked"})},e.decodeURL=function(t){return decodeURIComponent(t)},e.timeToLocal=function(t){return new Date(1e3*t)},e.absURL=function(t,e){var n=a.protocol(),i=(a.port(),n+"://"+location.host+"/news/"+t);return 1==e?i:i+"#disqus_thread"},e.setIndexThumbBorder=function(t){var e="#fff";return""!=t.image.url&&(e="#ededed"),{border:"1px solid "+e}},e.right_panel_item=function(t){return""==t.image.url?"s12":"s9 offset-s2"},e.news_tag_style=function(t){var e={y:"#ffca28",w:"#ff7043",b:"#81c784",p:"#4db6ac",e:"#9575cd",s:"#afb42b",t:"#81d4fa",ir:"#80cbc4"};return{"background-color":e[t]}}}])}(),function(){"use strict";app.factory("newsListHttp",["$http","Utils",function(t,e){return{getApi:function(e,n){return t.get(e,n)}}}])}(),function(){"use strict";app.directive("newsListBox",["Utils","newsListHttp","httpService","APP_CONFIG",function(t,e,n,i){return{restrict:"E",templateUrl:"js/news_list_box/template/newsListBox.html",scope:{data:"=",api:"@",title:"@"},link:function(o,a){o.data={},o.getData=function(){e.getApi(o.api).success(function(t){o.data=t}).error(function(e){t.log(e)})},o.right_panel_item=function(t){return""==t.image.url?"s12":"s9 offset-s2"},o.news_tag_style=function(t){var e={y:"#ffca28",w:"#ff7043",b:"#81c784",p:"#4db6ac",e:"#9575cd",s:"#afb42b",t:"#81d4fa",ir:"#80cbc4"};return{"background-color":e[t]}},o.absURL=function(e,i){var o=n.absURL(e,i);return t.log("absurl"),t.log(o),o},o.title_limit=i.title_limit,o.getData()}}}])}(),function(){"use strict";app.service("newsPageService",["$http",function(t){return{getNewsItem:function(e){return t.get("/news_item",{params:{news_id:e}})}}}])}(),function(){"use strict";app.controller("NewsPageCtrl",["$routeParams","newsPageService","$scope","$analytics","$location","$rootScope","APP_CONFIG",function(t,e,n,i,o,a,r){e.getNewsItem(t.id).then(function(t,e){n.news_item=t.data,i.eventTrack("news_item",{category:"news_item",label:n.news_item.title})}),n.title_limit=r.title_limit,n.absURL=function(t,e){{var n=o.protocol();o.port(),n+"://"+location.host+"/news/"+t}return 1==e?t:decodeURIComponent(t.url)},n.decodeURL=function(t){return decodeURIComponent(t)},n.news_tag_style=function(t){var e={y:"#ffca28",w:"#ff7043",b:"#81c784",p:"#4db6ac",e:"#9575cd",s:"#afb42b",t:"#81d4fa",ir:"#80cbc4"};return{"background-color":e[t]}}}])}(),function(){"use strict";app.factory("newsDataAccessor",function(){var t=[];return{getNewsItems:function(){return t},setNewsItems:function(e){e=t}}}),app.directive("newsInit",["Utils","newsDataAccessor",function(t,e){return{restrict:"A",scope:{data:"="},link:function(e,n,i){t.log(e.data),t.printMe("this!!!")}}}])}(),function(){"use strict";app.factory("jwtServices",["API","auth",function(t,e){return{authInterceptor:function(t){return t},response:function(t){return t}}}]),app.service("authService",["$window",function(t){}]),app.service("userService",["$http","API","auth",function(t,e,n){var i=this;i.getQuote=function(){return t.get(e+"/auth/qoute")}}])}(),function(){"use strict";app.factory("httpService",["$http","$location",function(t,e){return{getIndexNews:function(e){t.get("/get_index_news").success(function(t,n){e(t,n)})},getNewsContent:function(e,n){t.get("/"+e).success(function(t,e){n(t,e)})},feedMoreNews:function(e,n,i){t({method:"POST",url:"/feed_more",data:{ContentType:e,Skip:n}}).success(function(t,e){i(t,e)})},incrementNewsItemScore:function(e){t({method:"POST",url:"/increment_news",data:{Id:e._id}}).success(function(t,e){})},fetchHeaderCategories:function(e){t.get("/header_categories").success(function(t,n){e(t)})},fetchCategoryNews:function(e){return t({url:"/fetch_category_news",method:"GET",params:{initial:e}})},fetchTopRankingNews:function(e){t.get("/top_ranking_news").success(function(t,n){e(t)})},fetchHeadlines:function(e){t.get("/headlines").success(function(t,n){e(t)})},fetchUniqueSessionId:function(e){t.get("/get_unique_session").success(function(t){e(t)})},absURL:function(t,n){var i=e.protocol(),o=(e.port(),i+"://"+location.host+"/news/"+t);return 1==n?o:o+"#disqus_thread"}}}])}(),function(){"use strict";app.factory("strServices",function(){return{truncateStr:function(t,e){return t.length>e?t.substring(0,e)+"...":t}}})}(),function(){"use strict";app.factory("userLocation",function(){return{getLocation:function(){console.log(navigator.geolocation),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){console.log(t)})}}})}(),function(){"use strict";app.factory("userSession",["$cookies","APP_CONFIG","Utils","httpService",function(t,e,n,i){return{userSessionId:function(){n.log(e.APP_NAME);var i=t.get[e.APP_NAME.toLowerCase()];return i},setUserSession:function(){i.fetchUniqueSessionId(function(t){n.log(t)})}}}])}(),function(){"use strict";app.controller("loginController",["$scope",function(t){}])}(),function(){"use strict";app.controller("AdminController",["$scope",function(t){$("#menu-toggle").click(function(t){t.preventDefault(),$("#wrapper").toggleClass("toggled")})}])}(),function(){"use strict";app.directive("categoryMenu",["httpService","$rootScope","$location",function(t,e,n){return{restrict:"E",templateUrl:"js/shared/templates/category_menu.html",controller:["$scope",function(i){$(".button-collapse").sideNav({closeOnClick:!0}),i.category_lists=[],i.categories=function(){t.fetchHeaderCategories(function(t){i.category_lists=_.map(t,function(t){return t})})},i.category_get=function(i){var o=n.path();return""==o.match("/(.*)$")[1]||o.match("/news")?(window.location.href="/"+i.initial,!1):(e.$emit("empty_main_index_news"),e.$emit("update_current_news_cat",i),e.current_news_cat_name=i,void t.fetchCategoryNews(i.initial).success(function(t){e.$emit("update_main_index_news",t),n.path("/"+i.initial)}))}}]}}])}(),function(){"use strict";app.directive("globalHeader",["APP_CONFIG","$rootScope",function(t,e){return{restrict:"E",templateUrl:"js/shared/templates/global_header.html",link:function(e){e.app_name=t.APP_NAME}}}])}(),function(){"use strict";app.directive("headlines",["httpService","$location","strServices",function(t,e,n){return{restrict:"E",templateUrl:"js/shared/templates/headlines.html",link:function(i){t.fetchHeadlines(function(t){i.headlines=t}),i.truncateTitle=function(t){return n.truncateStr(t,35)},i.absURL=function(t,n){var i=e.protocol(),o=(e.port(),i+"://"+location.host+"/news/"+t);return 1==n?o:o+"#disqus_thread"}}}}])}(),function(){"use strict";app.directive("loadSpinner",function(){return{restrict:"E",templateUrl:"js/shared/templates/load_spinner.html",scope:{data:"="},link:function(t){}}})}(),function(){"use strict";app.directive("newRelicBrowser",function(){return{restrict:"E",templateUrl:"js/shared/templates/newrelic_browser.html",link:function(){}}})}(),function(){"use strict";app.directive("overallFooter",["$analytics",function(t){return{restrict:"E",templateUrl:"js/shared/templates/overallfooter.html",controller:["$scope",function(e){e.luxiar_co=function(){t.eventTrack("luxiar_homepage",{category:"luxiar_co",label:"footer link"}),window.open("http://www.luxiar.com/","_blank")}}]}}])}(),function(){"use strict";app.directive("overallHeader",["$rootScope","$analytics","httpService","$location","APP_CONFIG",function(t,e,n,i,o){return{restrict:"E",templateUrl:"js/shared/templates/overallheader.html",controller:["$scope",function(a){a.app_name=o.APP_NAME,a.current_news_cat=t.current_news_cat_name||"",t.$on("update_current_news_cat",function(t,e){a.current_news_cat=e}),a.news_content=function(o){t.content_type=o,e.eventTrack("index",{category:"index_main",label:o}),"/"!=i.path()?window.location.href="/":n.getNewsContent(t.content_type,function(e,n){a.news_content_type=t.content_type,a.main_index_news=e})},a.category_get=function(e){n.fetchCategoryNews(e).success(function(e){t.$emit("update_main_index_news",e)})}}]}}])}(),function(){"use strict";function t(t){return(t+"").length>1?t:("0"+t).slice(-2)}var e=500;app.directive("imageLoader",function(){return{restrict:"E",scope:{data:"="},templateUrl:"js/shared/templates/newsitem_index_thumb.html",link:function(t,e,n){t.news_item=t.data}}}),app.directive("popularIndexThumb",function(){return{restrict:"E",scope:{data:"="},templateUrl:"js/shared/templates/popular_index_thumb.html",link:function(t){t.item=t.data}}}),app.factory("adjustStageHeight",["$document",function(t){return{adjustHeight:function(){return t.height()+e+"px"}}}]),app.directive("dateFormatDayMonth",function(){return{restrict:"E",scope:{data:"="},template:"{{ dateStr }}",link:function(e){var n=new Date(e.data.created_at),i=n.getDate(),o=n.getMonth()+1,a=t(n.getHours()),r=t(n.getMinutes());e.dateStr=i+"日 "+o+"月"+a+":"+r}}}),app.factory("Utils",function(){return{log:function(t){console.log(t)},printMe:function(t){this.log("debug: "+t)}}})}();