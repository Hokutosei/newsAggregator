!function(e,t,n){"use strict";function i(e,n,i){o.directive(e,["$parse","$swipe",function(o,a){var r=75,c=.3,s=30;return function(u,l,f){function p(e){if(!g)return!1;var t=Math.abs(e.y-g.y),i=(e.x-g.x)*n;return d&&r>t&&i>0&&i>s&&c>t/i}var g,d,h=o(f[e]),m=["touch"];t.isDefined(f.ngSwipeDisableMouse)||m.push("mouse"),a.bind(l,{start:function(e,t){g=e,d=!0},cancel:function(e){d=!1},end:function(e,t){p(e)&&u.$apply(function(){l.triggerHandler(i),h(u,{$event:t})})}},m)}}])}var o=t.module("ngTouch",[]);o.factory("$swipe",[function(){function e(e){var t=e.touches&&e.touches.length?e.touches:[e],n=e.changedTouches&&e.changedTouches[0]||e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]||t[0].originalEvent||t[0];return{x:n.clientX,y:n.clientY}}function n(e,n){var i=[];return t.forEach(e,function(e){var t=o[e][n];t&&i.push(t)}),i.join(" ")}var i=10,o={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}};return{bind:function(t,o,a){var r,c,s,u,l=!1;a=a||["mouse","touch"],t.on(n(a,"start"),function(t){s=e(t),l=!0,r=0,c=0,u=s,o.start&&o.start(s,t)});var f=n(a,"cancel");f&&t.on(f,function(e){l=!1,o.cancel&&o.cancel(e)}),t.on(n(a,"move"),function(t){if(l&&s){var n=e(t);if(r+=Math.abs(n.x-u.x),c+=Math.abs(n.y-u.y),u=n,!(i>r&&i>c))return c>r?(l=!1,void(o.cancel&&o.cancel(t))):(t.preventDefault(),void(o.move&&o.move(n,t)))}}),t.on(n(a,"end"),function(t){l&&(l=!1,o.end&&o.end(e(t),t))})}}}]),o.config(["$provide",function(e){e.decorator("ngClickDirective",["$delegate",function(e){return e.shift(),e}])}]),o.directive("ngClick",["$parse","$timeout","$rootElement",function(e,n,i){function o(e,t,n,i){return Math.abs(e-n)<h&&Math.abs(t-i)<h}function a(e,t,n){for(var i=0;i<e.length;i+=2)if(o(e[i],e[i+1],t,n))return e.splice(i,i+2),!0;return!1}function r(e){if(!(Date.now()-u>d)){var t=e.touches&&e.touches.length?e.touches:[e],n=t[0].clientX,i=t[0].clientY;1>n&&1>i||f&&f[0]===n&&f[1]===i||(f&&(f=null),"label"===e.target.tagName.toLowerCase()&&(f=[n,i]),a(l,n,i)||(e.stopPropagation(),e.preventDefault(),e.target&&e.target.blur()))}}function c(e){var t=e.touches&&e.touches.length?e.touches:[e],i=t[0].clientX,o=t[0].clientY;l.push(i,o),n(function(){for(var e=0;e<l.length;e+=2)if(l[e]==i&&l[e+1]==o)return void l.splice(e,e+2)},d,!1)}function s(e,t){l||(i[0].addEventListener("click",r,!0),i[0].addEventListener("touchstart",c,!0),l=[]),u=Date.now(),a(l,e,t)}var u,l,f,p=750,g=12,d=2500,h=25,m="ng-click-active";return function(n,i,o){function a(){d=!1,i.removeClass(m)}var r,c,u,l,f=e(o.ngClick),d=!1;i.on("touchstart",function(e){d=!0,r=e.target?e.target:e.srcElement,3==r.nodeType&&(r=r.parentNode),i.addClass(m),c=Date.now();var t=e.touches&&e.touches.length?e.touches:[e],n=t[0].originalEvent||t[0];u=n.clientX,l=n.clientY}),i.on("touchmove",function(e){a()}),i.on("touchcancel",function(e){a()}),i.on("touchend",function(e){var n=Date.now()-c,f=e.changedTouches&&e.changedTouches.length?e.changedTouches:e.touches&&e.touches.length?e.touches:[e],h=f[0].originalEvent||f[0],m=h.clientX,v=h.clientY,w=Math.sqrt(Math.pow(m-u,2)+Math.pow(v-l,2));d&&p>n&&g>w&&(s(m,v),r&&r.blur(),t.isDefined(o.disabled)&&o.disabled!==!1||i.triggerHandler("click",[e])),a()}),i.onclick=function(e){},i.on("click",function(e,t){n.$apply(function(){f(n,{$event:t||e})})}),i.on("mousedown",function(e){i.addClass(m)}),i.on("mousemove mouseup",function(e){i.removeClass(m)})}}]),i("ngSwipeLeft",-1,"swipeleft"),i("ngSwipeRight",1,"swiperight")}(window,window.angular),function(e){"use strict";e.module("angulartics.google.analytics",["angulartics"]).config(["$analyticsProvider",function(e){e.settings.trackRelativePath=!0,e.registerPageTrack(function(e){window._gaq&&_gaq.push(["_trackPageview",e]),window.ga&&ga("send","pageview",e)}),e.registerEventTrack(function(e,t){if(t&&t.category){if(t.value){var n=parseInt(t.value,10);t.value=isNaN(n)?0:n}if(window._gaq)_gaq.push(["_trackEvent",t.category,e,t.label,t.value,t.noninteraction]);else if(window.ga){for(var i={eventCategory:t.category||null,eventAction:e||null,eventLabel:t.label||null,eventValue:t.value||null,nonInteraction:t.noninteraction||null},o=1;20>=o;o++)t["dimension"+o.toString()]&&(i["dimension"+o.toString()]=t["dimension"+o.toString()]),t["metric"+o.toString()]&&(i["metric"+o.toString()]=t["metric"+o.toString()]);ga("send","event",i)}}})}])}(angular),function(e,t){"use strict";var n=window.angulartics||(window.angulartics={});n.waitForVendorCount=0,n.waitForVendorApi=function(e,t,i,o,a){a||n.waitForVendorCount++,o||(o=i,i=void 0),!Object.prototype.hasOwnProperty.call(window,e)||void 0!==i&&void 0===window[e][i]?setTimeout(function(){n.waitForVendorApi(e,t,i,o,!0)},t):(n.waitForVendorCount--,o(window[e]))},e.module("angulartics",[]).provider("$analytics",function(){var t={pageTracking:{autoTrackFirstPage:!0,autoTrackVirtualPages:!0,trackRelativePath:!1,autoBasePath:!1,basePath:""},eventTracking:{},bufferFlushDelay:1e3},i=["pageTrack","eventTrack","setAlias","setUsername","setUserProperties","setUserPropertiesOnce","setSuperProperties","setSuperPropertiesOnce"],o={},a={},r=function(e){return function(){n.waitForVendorCount&&(o[e]||(o[e]=[]),o[e].push(arguments))}},c=function(t,n){return a[t]||(a[t]=[]),a[t].push(n),function(){var n=arguments;e.forEach(a[t],function(e){e.apply(this,n)},this)}},s={settings:t},u=function(e,t){t?setTimeout(e,t):e()},l={$get:function(){return s},api:s,settings:t,virtualPageviews:function(e){this.settings.pageTracking.autoTrackVirtualPages=e},firstPageview:function(e){this.settings.pageTracking.autoTrackFirstPage=e},withBase:function(t){this.settings.pageTracking.basePath=t?e.element("base").attr("href").slice(0,-1):""},withAutoBase:function(e){this.settings.pageTracking.autoBasePath=e}},f=function(n,i){s[n]=c(n,i);var a=t[n],r=a?a.bufferFlushDelay:null,l=null!==r?r:t.bufferFlushDelay;e.forEach(o[n],function(e,t){u(function(){i.apply(this,e)},t*l)})},p=function(e){return e.replace(/^./,function(e){return e.toUpperCase()})},g=function(e){var t="register"+p(e);l[t]=function(t){f(e,t)},s[e]=c(e,r(e))};return e.forEach(i,g),l}).run(["$rootScope","$location","$window","$analytics","$injector",function(e,t,n,i,o){if(i.settings.pageTracking.autoTrackFirstPage){var a=!0;if(o.has("$route")){var r=o.get("$route");for(var c in r.routes){a=!1;break}}else if(o.has("$state")){var s=o.get("$state");for(var u in s.get()){a=!1;break}}if(a)if(i.settings.pageTracking.autoBasePath&&(i.settings.pageTracking.basePath=n.location.pathname),i.settings.trackRelativePath){var l=i.settings.pageTracking.basePath+t.url();i.pageTrack(l)}else i.pageTrack(t.absUrl())}i.settings.pageTracking.autoTrackVirtualPages&&(i.settings.pageTracking.autoBasePath&&(i.settings.pageTracking.basePath=n.location.pathname+"#"),o.has("$route")&&e.$on("$routeChangeSuccess",function(e,n){if(!n||!(n.$$route||n).redirectTo){var o=i.settings.pageTracking.basePath+t.url();i.pageTrack(o)}}),o.has("$state")&&e.$on("$stateChangeSuccess",function(e,n){var o=i.settings.pageTracking.basePath+t.url();i.pageTrack(o)}))}]).directive("analyticsOn",["$analytics",function(t){function n(e){return["a:","button:","button:button","button:submit","input:button","input:submit"].indexOf(e.tagName.toLowerCase()+":"+(e.type||""))>=0}function i(e){return n(e),"click"}function o(e){return n(e)?e.innerText||e.value:e.id||e.name||e.tagName}function a(e){return"analytics"===e.substr(0,9)&&-1===["On","Event","If","Properties","EventType"].indexOf(e.substr(9))}function r(e){var t=e.slice(9);return"undefined"!=typeof t&&null!==t&&t.length>0?t.substring(0,1).toLowerCase()+t.substring(1):t}return{restrict:"A",scope:!0,link:function(n,c,s){var u=s.analyticsOn||i(c[0]);n.$analytics={},e.forEach(s.$attr,function(e,t){a(t)&&(n.$analytics[r(t)]=s[t],s.$observe(t,function(e){n.$analytics[r(t)]=e}))}),e.element(c[0]).bind(u,function(i){var a=s.analyticsEvent||o(c[0]);n.$analytics.eventType=i.type,(!s.analyticsIf||n.$eval(s.analyticsIf))&&(s.analyticsProperties&&e.extend(n.$analytics,n.$eval(s.analyticsProperties)),t.eventTrack(a,n.$analytics))})}}}])}(angular),function(){"use strict";app=angular.module("newsAggregator",["ngTouch","ngCookies","angulartics","angulartics.google.analytics","ngResource","ngRoute"]);app.config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"js/index_page/index.html",controller:"MainCtrl"}).when("/:q",{templateUrl:"js/index_page/index.html",controller:"MainCtrl"}).when("/admin",{templateUrl:"js/pages/admin/templates/admin.html",controller:"AdminController"}).when("/news/:id",{templateUrl:"js/news_page/template/news.html",controller:"NewsPageCtrl"}).when("/registration",{templateUrl:"js/user/templates/login.html",controller:"loginController"}).otherwise({redirectTo:"/"}),t.html5Mode({enabled:!0,requireBase:!0})}]),app.run(["$rootScope","$timeout",function(e,t){e.$on("$routeChangeSuccess",function(e,t){!function(e,t,n){var i=function(){var i,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(i=e.createElement(t),i.id=n,i.src="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.4&appId=604252113051244",o.parentNode.insertBefore(i,o))};i(),setTimeout(function(){i(),FB.XFBML.parse()},4e3)}(document,"script","facebook-jssdk")})}]),app.constant("API","http://localhost:3000")}(),function(){"use strict";app.constant("APP_CONFIG",{APP_NAME:"NewsInstance",title_limit:25})}(),function(){"use strict";app.controller("HeaderCtrl",["$scope",function(e){e.project_name="learnJap"}]),app.controller("MainCtrl",["$scope","$window","httpService","$analytics","$location","$rootScope","userLocation","$routeParams","userSession","$timeout","adjustStageHeight","APP_CONFIG",function(e,t,n,i,o,a,r,c,s,u,l,f){i.pageTrack("/"),i.eventTrack("index",{category:"index_main",label:"index_label"}),e.news_content_type="latest_news",a.page_title="newsInstance",e.title_limit=f.title_limit,a.content_type=e.news_content_type,e.main_index_news=[],e.main_index_topranks=[];var p=function(){n.fetchTopRankingNews(function(t,n){e.main_index_topranks=t})},g=function(){$(".materialboxed").materialbox(),$(".dropdown-button").dropdown(),e.news_category_style={},1==_.has(c,"q")&&"registration"!=c.q?n.fetchCategoryNews(c.q).success(function(t){e.main_index_news=t}):n.getNewsContent(a.content_type,function(t,n){e.main_index_news=t.reverse()}),p()};e.news_content=function(t){a.content_type=t,i.eventTrack("index",{category:"index_main",label:t}),"/"!=o.path()?window.location.href="/":n.getNewsContent(a.content_type,function(t,n){e.news_content_type=a.content_type,e.main_index_news=t})},e.feed_more=function(t){i.eventTrack("feed_more",{category:"system_func",label:"feed_more_data"}),n.feedMoreNews(e.news_content_type,t,function(t,n){for(var i=0;i<t.length;i++)e.main_index_news.push(t[i])})},a.$on("update_main_index_news",function(t,n){e.main_index_news=n}),a.$on("empty_main_index_news",function(){e.main_index_news=[]}),e.ga_event=function(e){n.incrementNewsItemScore(e),i.eventTrack("news_item_"+e.title,{category:"news_clicks",label:"news_item_clicked"})},e.decodeURL=function(e){return decodeURIComponent(e)},e.timeToLocal=function(e){return new Date(1e3*e)},e.absURL=function(e,t){var n=o.protocol(),i=(o.port(),n+"://"+location.host+"/news/"+e);return 1==t?i:i+"#disqus_thread"},e.setIndexThumbBorder=function(e){var t="#fff";return""!=e.image.url&&(t="#ededed"),{border:"1px solid "+t}},e.right_panel_item=function(e){return""==e.image.url?"s12":"s9 offset-s2"},e.news_tag_style=function(e){var t={y:"#ffca28",w:"#ff7043",b:"#81c784",p:"#4db6ac",e:"#9575cd",s:"#afb42b",t:"#81d4fa",ir:"#80cbc4"};return{"background-color":t[e]}},g()}])}(),function(){"use strict";app.service("newsPageService",["$http",function(e){return{getNewsItem:function(t){return e.get("/news_item",{params:{news_id:t}})}}}])}(),function(){"use strict";app.controller("NewsPageCtrl",["$routeParams","newsPageService","$scope","$analytics","$location","$rootScope","APP_CONFIG",function(e,t,n,i,o,a,r){t.getNewsItem(e.id).then(function(e,t){n.news_item=e.data,i.eventTrack("news_item",{category:"news_item",label:n.news_item.title})}),n.title_limit=r.title_limit,n.absURL=function(e,t){{var n=o.protocol();o.port(),n+"://"+location.host+"/news/"+e}return 1==t?e:decodeURIComponent(e.url)},n.decodeURL=function(e){return decodeURIComponent(e)},n.news_tag_style=function(e){var t={y:"#ffca28",w:"#ff7043",b:"#81c784",p:"#4db6ac",e:"#9575cd",s:"#afb42b",t:"#81d4fa",ir:"#80cbc4"};return{"background-color":t[e]}}}])}(),function(){"use strict";app.factory("jwtServices",["API","auth",function(e,t){return{authInterceptor:function(e){return e},response:function(e){return e}}}]),app.service("authService",["$window",function(e){}]),app.service("userService",["$http","API","auth",function(e,t,n){var i=this;i.getQuote=function(){return e.get(t+"/auth/qoute")}}])}(),function(){"use strict";app.factory("httpService",["$http",function(e){return{getIndexNews:function(t){e.get("/get_index_news").success(function(e,n){t(e,n)})},getNewsContent:function(t,n){e.get("/"+t).success(function(e,t){n(e,t)})},feedMoreNews:function(t,n,i){e({method:"POST",url:"/feed_more",data:{ContentType:t,Skip:n}}).success(function(e,t){i(e,t)})},incrementNewsItemScore:function(t){e({method:"POST",url:"/increment_news",data:{Id:t._id}}).success(function(e,t){})},fetchHeaderCategories:function(t){e.get("/header_categories").success(function(e,n){t(e)})},fetchCategoryNews:function(t){return e({url:"/fetch_category_news",method:"GET",params:{initial:t}})},fetchTopRankingNews:function(t){e.get("/top_ranking_news").success(function(e,n){t(e)})},fetchHeadlines:function(t){e.get("/headlines").success(function(e,n){t(e)})}}}])}(),function(){"use strict";app.factory("strServices",function(){return{truncateStr:function(e,t){return e.length>t?e.substring(0,t)+"...":e}}})}(),function(){"use strict";app.factory("userLocation",function(){return{getLocation:function(){console.log(navigator.geolocation),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){console.log(e)})}}})}(),function(){"use strict";app.factory("userSession",["$cookies",function(e){return{userSessionId:function(){var t=e.get.kedoyoId;return t}}}])}(),function(){"use strict";app.controller("loginController",["$scope",function(e){}])}(),function(){"use strict";app.controller("AdminController",["$scope",function(e){$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")})}])}(),function(){"use strict";app.directive("categoryMenu",["httpService","$rootScope","$location",function(e,t,n){return{restrict:"E",templateUrl:"js/shared/templates/category_menu.html",controller:["$scope",function(i){$(".button-collapse").sideNav({closeOnClick:!0}),i.category_lists=[],i.categories=function(){e.fetchHeaderCategories(function(e){i.category_lists=_.map(e,function(e){return e})})},i.category_get=function(i){var o=n.path();return""==o.match("/(.*)$")[1]||o.match("/news")?(window.location.href="/"+i.initial,!1):(t.$emit("empty_main_index_news"),t.$emit("update_current_news_cat",i),t.current_news_cat_name=i,void e.fetchCategoryNews(i.initial).success(function(e){t.$emit("update_main_index_news",e),n.path("/"+i.initial)}))}}]}}])}(),function(){"use strict";app.directive("globalHeader",["APP_CONFIG","$rootScope",function(e,t){return{restrict:"E",templateUrl:"js/shared/templates/global_header.html",link:function(t){t.app_name=e.APP_NAME}}}])}(),function(){"use strict";app.directive("headlines",["httpService","$location","strServices",function(e,t,n){return{restrict:"E",templateUrl:"js/shared/templates/headlines.html",link:function(i){e.fetchHeadlines(function(e){i.headlines=e}),i.truncateTitle=function(e){return n.truncateStr(e,35)},i.absURL=function(e,n){var i=t.protocol(),o=(t.port(),i+"://"+location.host+"/news/"+e);return 1==n?o:o+"#disqus_thread"}}}}])}(),function(){"use strict";app.directive("loadSpinner",function(){return{restrict:"E",templateUrl:"js/shared/templates/load_spinner.html",scope:{data:"="},link:function(e){}}})}(),function(){"use strict";app.directive("newRelicBrowser",function(){return{restrict:"E",templateUrl:"js/shared/templates/newrelic_browser.html",link:function(){}}})}(),function(){"use strict";app.directive("overallFooter",["$analytics",function(e){return{restrict:"E",templateUrl:"js/shared/templates/overallfooter.html",controller:["$scope",function(t){t.luxiar_co=function(){e.eventTrack("luxiar_homepage",{category:"luxiar_co",label:"footer link"}),window.open("http://www.luxiar.com/","_blank")}}]}}])}(),function(){"use strict";app.directive("overallHeader",["$rootScope","$analytics","httpService","$location","APP_CONFIG",function(e,t,n,i,o){return{restrict:"E",templateUrl:"js/shared/templates/overallheader.html",controller:["$scope",function(a){a.app_name=o.APP_NAME,a.current_news_cat=e.current_news_cat_name||"",e.$on("update_current_news_cat",function(e,t){a.current_news_cat=t}),a.news_content=function(o){e.content_type=o,t.eventTrack("index",{category:"index_main",label:o}),"/"!=i.path()?window.location.href="/":n.getNewsContent(e.content_type,function(t,n){a.news_content_type=e.content_type,a.main_index_news=t})},a.category_get=function(t){n.fetchCategoryNews(t).success(function(t){e.$emit("update_main_index_news",t)})}}]}}])}(),function(){"use strict";function e(e){return(e+"").length>1?e:("0"+e).slice(-2)}var t=500;app.directive("imageLoader",function(){return{restrict:"E",scope:{data:"="},templateUrl:"js/shared/templates/newsitem_index_thumb.html",link:function(e,t,n){e.news_item=e.data}}}),app.directive("popularIndexThumb",function(){return{restrict:"E",scope:{data:"="},templateUrl:"js/shared/templates/popular_index_thumb.html",link:function(e){e.item=e.data}}}),app.factory("adjustStageHeight",["$document",function(e){return{adjustHeight:function(){return e.height()+t+"px"}}}]),app.directive("dateFormatDayMonth",function(){return{restrict:"E",scope:{data:"="},template:"{{ dateStr }}",link:function(t){var n=new Date(t.data.created_at),i=n.getDate(),o=n.getMonth()+1,a=e(n.getHours()),r=e(n.getMinutes());t.dateStr=i+"日 "+o+"月"+a+":"+r}}})}();